rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ğŸ‘¤ ì‚¬ìš©ì ì •ë³´ (Users) - ê¸°ì¡´ ìœ ì§€
    match /Users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow read, update: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
    }

    // ğŸ‘¥ ì „ì²´ íšŒì› ì •ë³´ (ëŒ€ë¬¸ì Members) - ê¸°ì¡´ ìœ ì§€
    match /Members/{memberId} {
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "teacher";
    }

    // ğŸ‘¥ ì„¸ë¶€ì‚¬ì—…ë³„ ì´ìš©ì ê´€ë¦¬ (SubProgramUsers) - âœ… ê°•ì‚¬ ì½ê¸° ê¶Œí•œ ì¶”ê°€
    match /SubProgramUsers/{memberId} {
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "teacher";
    }

    // âœ… ì¶œì„ ë° ì‹¤ì  ê¸°ë¡ - ê°•ì‚¬ ê¶Œí•œ ì¶”ê°€
    match /AttendanceRecords/{recordId} {
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager", "teacher"];
    }

    // âœ… ì¶œì„ ì‹¤ì  ì¢…í•© - ê°•ì‚¬ ê¶Œí•œ ì¶”ê°€  
    match /AttendancePerformance/{recordId} {
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager", "teacher"];
    }

    // ğŸ“Š ì‹¤ì  ìš”ì•½ ì •ë³´ - âœ… ê°•ì‚¬ ì½ê¸° ê¶Œí•œ ì¶”ê°€
    match /PerformanceSummary/{summaryId} {
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager", "teacher"];
      allow write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
    }

    // ğŸ“‚ í”„ë¡œê·¸ë¨ êµ¬ì¡° - ê¸°ì¡´ ìœ ì§€
    match /ProgramStructure/{docId} {
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "teacher";
    }

    // ğŸ§‘â€ğŸ« ê°•ì‚¬-ì„¸ë¶€ì‚¬ì—… ë§¤í•‘ - âœ… ê°•ì‚¬ ì½ê¸° ê¶Œí•œ ì¶”ê°€
    match /TeacherSubProgramMap/{docId} {
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "teacher";
    }

    // ğŸ” íŒ€-ì„¸ë¶€ì‚¬ì—… ë§¤í•‘ - âœ… ê°•ì‚¬ ì½ê¸° ê¶Œí•œ ì¶”ê°€
    match /TeamSubProgramMap/{docId} {
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "teacher";
    }

    // ğŸ“Š ëŒ€ëŸ‰ ì‹¤ì  ìš”ì•½ ì •ë³´ - âœ… ê°•ì‚¬ ì½ê¸° ê¶Œí•œ ì¶”ê°€
    match /BulkPerformanceSummary/{summaryId} {
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager", "teacher"];
      allow write, delete: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
    }

    // âœ… ğŸ“¥ ê°€ì… ìŠ¹ì¸ ëŒ€ê¸° íšŒì› - ê¸°ì¡´ ìœ ì§€
    match /PendingMembers/{id} {
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
      allow write, delete: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "manager"];
    }

    // ğŸ”’ ê·¸ ì™¸ ëª¨ë“  ë¬¸ì„œ ì ‘ê·¼ ì°¨ë‹¨ - ê¸°ì¡´ ìœ ì§€
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ğŸ‘¤ ì‚¬ìš©ì ì •ë³´ (Users)
    match /Users/{userId} {
      // ë³¸ì¸ ë¬¸ì„œ ì ‘ê·¼ ê°€ëŠ¥
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // ê´€ë¦¬ì(admin)ëŠ” ëª¨ë“  ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼ ê°€ëŠ¥
      allow read, update: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "admin";
    }

    // ğŸ‘¥ ì „ì²´ íšŒì› ì •ë³´ (ëŒ€ë¬¸ì Members)
    match /Members/{memberId} {
      // ê´€ë¦¬ì ì „ì²´ ì ‘ê·¼ ê°€ëŠ¥
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "admin";

      // êµì‚¬ëŠ” ë‹´ë‹¹ ì„¸ë¶€ì‚¬ì—…ë§Œ ì½ê¸° ê°€ëŠ¥
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "teacher" &&
        resource.data.subProgram in get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.subPrograms;
    }

    // ğŸ‘¥ ì„¸ë¶€ì‚¬ì—…ë³„ ì´ìš©ì ê´€ë¦¬ (ì†Œë¬¸ì members)
    match /SubProgramUsers/{memberId} {
  allow read, write: if request.auth != null &&
    get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "admin";
  allow read: if request.auth != null &&
    get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "teacher" &&
    resource.data.subProgram in get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.subPrograms;
}

    // âœ… ì¶œì„ ê¸°ë¡ (AttendanceRecords)
    match /AttendanceRecords/{recordId} {
      // ê´€ë¦¬ì, êµì‚¬ ëª¨ë‘ ì½ê¸°/ì“°ê¸° ê°€ëŠ¥
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "teacher"];
    }

    // ğŸ“Š ì‹¤ì  ìš”ì•½ ì •ë³´ (PerformanceSummary)
    match /PerformanceSummary/{summaryId} {
      // ì½ê¸°: ê´€ë¦¬ì, êµì‚¬
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role in ["admin", "teacher"];

      // ì“°ê¸°: ê´€ë¦¬ìë§Œ
      allow write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "admin";
    }

    // ğŸ“‚ í”„ë¡œê·¸ë¨ êµ¬ì¡° (ProgramStructure)
    match /ProgramStructure/{docId} {
      // ê´€ë¦¬ì: ì½ê¸°/ì“°ê¸°
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "admin";

      // êµì‚¬: ì½ê¸°ë§Œ ê°€ëŠ¥
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "teacher";
    }

    // ğŸ§‘â€ğŸ« ê°•ì‚¬-ì„¸ë¶€ì‚¬ì—… ë§¤í•‘
    match /TeacherSubProgramMap/{docId} {
      // ê´€ë¦¬ìë§Œ ì ‘ê·¼
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "admin";
    }

    // ğŸ” íŒ€-ì„¸ë¶€ì‚¬ì—… ë§¤í•‘
    match /TeamSubProgramMap/{docId} {
      // ê´€ë¦¬ìë§Œ ì ‘ê·¼
      allow read, write: if request.auth != null &&
        get(/databases/$(database)/documents/Users/$(request.auth.uid)).data.role == "admin";
    }

    // ğŸ”’ ê¸°íƒ€ ëª¨ë“  ë¬¸ì„œ: ì ‘ê·¼ ê¸ˆì§€
    match /{document=**} {
      allow read, write: if false;
    }
  }
}